<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta charset='utf-8'>
        <title>Configuration &middot; Documentation &middot; NCPA</title>
        <link rel="shortcut icon" type="image/png" href="../img/ncpa.png" />
        <link rel="icon" type="image/png" href="../img/ncpa.png" />
        <link rel="stylesheet" href="../css/bootstrap.min.css" type="text/css" />
        <link rel="stylesheet" href="../css/font-awesome.min.css" type="text/css" />
        <link rel="stylesheet" href="../css/ncpa.css" type="text/css" />
        <script src='../js/jquery.2.2.4.min.js'></script>
        <script src='../js/bootstrap.min.js'></script>
        <script src='../js/help.js'></script>
    </head>
    <body class="help">

    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12 col-lg-10">

                <h1>Configuration</h1>
                <p>On a successful install, NCPA will start working right out of the box. However, to tailor it to your needs, you will want to edit the configuration. You can set up NCPA security and web GUI settings, along with configuring passive check settings.</p>
                <p>This is meant to be a reference for all the configuration options available. Some configuration options are required, while others are just optional. We recommend keeping the configuration options that are defined by default, and tweaking them to your desired configuration. Doing it this way ensures that all non-default options will be defined.</p>
                <p>After editing the configuration, you must <a href="index.html#restarting-ncpa">restart the <em>NCPA Passive</em> and <em>NCPA Listener</em> services</a> to apply the new configuration.</p>
                <p>
                    <div class="alert alert-info">
                        <b>Note</b>: On Linux and Mac OS X, the default API token is set to <em>mytoken</em> and you will want to change this after install. Windows sets the token on install based on user input in the installer.
                    </div>
                </p>

                <div class="section">
                    <h2>Config Locations</h2>
                    <p>In order to configure NCPA, you will need to edit its configuration file, which is kept on the file system. On a default install, most of the configuration will be located in the <code>ncpa.cfg</code> file in the following directories on the selected operating system:</p>
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active"><a href="#windows" role="tab" data-toggle="tab"><i class="fa fa-windows fa-l fa-14"></i> Windows</a></li>
                        <li role="presentation"><a href="#linux" role="tab" data-toggle="tab"><i class="fa fa-linux fa-l fa-14"></i> Linux</a></li>
                        <li role="presentation"><a href="#mac" role="tab" data-toggle="tab"><i class="fa fa-apple fa-l fa-14"></i> Mac OS X</a></li>
                    </ul>
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="windows"><pre>C:\Program Files (x86)\Nagios\NCPA\etc\</pre></div>
                        <div role="tabpanel" class="tab-pane" id="linux"><pre>/usr/local/ncpa/etc/</pre></div>
                        <div role="tabpanel" class="tab-pane" id="mac"><pre>/usr/local/ncpa/etc/</pre></div>
                    </div>
                    <p>As of NCPA 2, there is also an <code>ncpa.cfg.d</code> folder which follows the standard of including all <b>.cfg</b> files inside of it into the main <code>nagios.cfg</code> when parsing the configuration. Another change to the way configuration works in NCPA 2 is that changing the passive check configuration <em>requires a restart of the NCPA Passive service</em>. By default NCPA 2 will create an <code>nrdp.cfg</code> file in <code>ncpa.cfg.d</code> directory on Linux and Mac OS X systems. On windows, you are able to select whether or not you are going to enable NRDP during the install - including setting up your basic default checks - placed in <code>nrdp.cfg</code> in <code>nrdp.cfg.d</code>.</p>
                </div>

                <a name="config-option-reference"></a>
                <div class="section">
                    <h2>Config Option Reference</h2>
                    <p>Below is a list of all available options for the configuration file. The configuration is a standard INI-style config using the <code>name = value</code> notation. However, note that the config file is sectioned off by the square brackets. These different sections affect different portions of NCPA's operation. Each section is seperately listed below.</p>
                    <p>
                        <div class="alert alert-info">
                            <b>Note</b>: You might notice that there appears to be duplicate entries. For instance, both <a href="#listener">[listener]</a> and <a href="#passive">[passive]</a> sections have a specification for <code>logfile</code>. Since these are two separate services, they maintain separate log files.
                        </div>
                    </p>
                </div>

                <a name="listener"></a>
                <div class="section">
                    <h3>[listener]</h3>
                    <p>This section is for the <em>NCPA Listener</em> service. It controls the web GUI, external authentication, the external API location, graphing integration, and active check settings. The <em>NCPA Listener</em> also runs an HTTP server to handle the API requests for both the API, GUI, and graphing sections. For this reason, this section is the only one that will require an address and a port to listen on.</p>
                    <table class="table table-striped">
                        <tbody>
                            <tr>
                                <th style="width: 10%;">ip</th>
                                <td>This determines what IP the agent will listen on. By default, it will listen on 0.0.0.0, which means it will listen on all interfaces and all name references. Specify this if you would only like the agent to listen on a specific IP or name.</td>
                            </tr>
                            <tr>
                                <th>port</th>
                                <td>This specifies the TCP port the NCPA listener service will bind to.</td>
                            </tr>
                            <tr>
                                <th>uid</th>
                                <td>Determines which user the NCPA listener service will run as.</td>
                            </tr>
                            <tr>
                                <th>gid</th>
                                <td>Determines the group by which the NCPA listener service will run as.</td>
                            </tr>
                            <tr>
                                <th>pidfile</th>
                                <td>The named file location where the PID file for the NCPA server will be stored and maintained.</td>
                            </tr>
                            <tr>
                                <th>logfile</th>
                                <td>The named file location where the log file for the NCPA server will be stored.</td>
                            </tr>
                            <tr>
                                <th>logmaxmb</th>
                                <td>The max size allowed for a log file in megabytes. When the log becomes larger than this, the log will be rolled over and a new log will be started.</td>
                            </tr>
                            <tr>
                                <th>logbackups</th>
                                <td>The max number of log rollovers that will be kept.</td>
                            </tr>
                            <tr>
                                <th>loglevel</th>
                                <td>The level of message that will be deemed important enough to be logged to the log file. Valid loglevels are INFO, NOTICE, WARNING and ERROR.</td>
                            </tr>
                            <tr>
                                <th>ssl_version</th>
                                <td>Set the SSL protocol to use when using HTTPS, valid selections are TLSv1, TLSv1_1, TLSv1_2 (default).</td>
                            </tr>
                            <tr>
                                <th>certificate</th>
                                <td>Allows you to specify the file name for the SSL certificate you wish to use with the NCPA listener service. If left adhoc, a new self-signed certificate will be generated and used for the server.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="section">
                    <h3>[api]</h3>
                    <p>This section controls how the API is accessed, and currently sports only one item.</p>
                    <table class="table table-striped">
                        <tbody>
                            <tr>
                                <th style="width: 10%;">community_string</th>
                                <td>The token that you use to authenticate when accessing the web interface. This should be something non-trivial.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <a name="passive"></a>
                <div class="section">
                    <h3>[passive]</h3>
                    <p>This section controls how the passive service behaves. It will specify things such as what it should do and how often it should be done.</p>
                    <table class="table table-striped">
                        <tbody>
                            <tr>
                                <th style="width: 10%;">sleep</th>
                                <td>The time in seconds which the service will wait until running again. Upon waking up, the service will check to see if it has anything to do. If it has nothing to do it will sleep again for the specified time.</td>
                            </tr>
                            <tr>
                                <th>handlers</th>
                                <td>This is where the magic happens with the NCPA passive agent. Handlers are items that are run whenever the passive daemon wakes up. The currently supported handlers are nrds and nrdp. This handlers list should be a comma-delimited list of handlers that are to be run. To run both nrds and nrdp handlers, this entry would be <em>handlers = nrds,nrdp</em>. More information is provided about what each of these handlers do under the <a class="reference internal" href="#nrds">[nrds]</a> and <a class="reference internal" href="#nrdp">[nrdp]</a> sections, respectively.</td>
                            </tr>
                            <tr>
                                <th>uid</th>
                                <td>Determines which user the NCPA passive service will run as during execution.</td>
                            </tr>
                            <tr>
                                <th>gid</th>
                                <td>Determines the group by which the NCPA passive service will run as during execution.</td>
                            </tr>
                            <tr>
                                <th>pidfile</th>
                                <td>The named file location where the PID file for the NCPA passive service will be stored and maintained.</td>
                            </tr>
                            <tr>
                                <th>logfile</th>
                                <td>The named file location where the log file for the NCPA passive service will be stored.</td>
                            </tr>
                            <tr>
                                <th>loglevel</th>
                                <td>The level of message that will be deemed important enough to be logged to the log file. Valid loglevels are INFO, NOTICE, WARNING and ERROR.</td>
                            </tr>
                            <tr>
                                <th>logmaxmb</th>
                                <td>The max size allowed for a log file in megabytes. When the log becomes larger than this, the log will be rolled over and a new log will be started.</td>
                            </tr>
                            <tr>
                                <th>logbackups</th>
                                <td>The max number of log rollovers that will be kept.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="section" id="nrdp">
                    <h3>[nrdp]</h3>
                    <p>The value <em>nrdp</em> must be present in the passive handlers declaration (above) to send any results back to the Nagios server. This section dictates where NRDP results will be sent and what tokens will be used.</p>
                    <table class="table table-striped">
                        <tbody>
                            <tr>
                                <th style="width: 10%;">parent</th>
                                <td>The IP address of the Nagios server to which the passive check results should be sent. The wording on this may seem a bit confusing, but it&#8217;s for a reason. The NCPA agent can also function as a NRDP forwarder. If you sent NRDP results to the NCPA listener&#8217;s IP with the proper token, it will forward the NRDP check results to its parent which is this directive. This allows for you to have a chain of NRDP forwards if firewall constraints are incredibly heavy.</td>
                            </tr>
                            <tr>
                                <th>token</th>
                                <td>The token to use to access its parent. Should not be the same as the token NCPA uses for its own server for security reasons.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!--
                <div class="section" id="nrds">
                    <h3>[nrds]</h3>
                    <p>The value <em>nrds</em> must be present in the passive handler declaration (above) in order to pull down any new configuration. <a class="reference external" href="https://exchange.nagios.org/directory/Addons/Components/Nagios-Remote-Data-Sender-(NRDS)/details">NRDS</a> is a slick way to manage your configuration files. Many of these directives are boilerplate. The interesting directives are identified in the following. For more information on NRDS see the above link for further definitions of these terms.</p>
                    <table class="table table-striped">
                        <tbody>
                            <tr>
                                <th style="width: 10%;">CONFIG_NAME</th>
                                <td>This is the name that the NCPA passive service will query for updates and is set up in Nagios XI.</td>
                            </tr>
                            <tr>
                                <th>TOKEN</th>
                                <td>The token the NCPA passive service will use when connecting to the NRDS server.</td>
                            </tr>
                            <tr>
                                <th>URL</th>
                                <td>The URL to be queried for NRDS information.</td>
                            </tr>
                            <tr>
                                <th>UPDATE_CONFIG</th>
                                <td>If this is set to 1, then the config will be updated automatically when a new config becomes available. If anything else, it will not be updated.</td>
                            </tr>
                            <tr>
                                <th>UPDATE_PLUGINS</th>
                                <td>If this is set to 1, then the plugins in the plugins/ directory will be automatically maintained using NRDS.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                -->

                <div class="section" id="passive-checks">
                    <h3>[passive checks]</h3>
                    <p>This section does have a hard and fast set of concrete instructions. For information on setting up passive checks, see the section <a class="reference internal" href="passive.html#passive-checks"><span class="std std-ref">Setting Up Passive Checks</span></a>.</p>
                </div>

                <div class="section" id="plugin-directives">
                    <h3>[plugin directives]</h3>
                    <p>This section is where you can specify both the plugin directory and special operations that should be executed when a given file type is executed as part of a service check. Some examples for the special directives are given.</p>
                    <table class="table table-striped">
                        <tbody>
                            <tr>
                                <th style="width: 10%;">plugin_path</th>
                                <td>The path to the directory containing any third party plugins that need to be run.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>

    </body>
</html>